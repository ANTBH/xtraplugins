import random
import re # استيراد مكتبة التعبيرات النمطية
from pyrogram import filters
from YukkiMusic import app  # تأكد من أن هذا هو المسار الصحيح لاستيراد كائن التطبيق 'app'

# --- قائمة نصائح السلف الصالح (100 نصيحة) ---
# هذه القائمة ستُستخدم لجميع الأوامر: نصيحة, نصيحه, فائدة
SALAF_ADVICE = [
    "قال الحسن البصري رحمه الله: يا ابن آدم، إنما أنت أيام مجموعة، كلما ذهب يوم ذهب بعضك.",
    "قال الإمام الشافعي رحمه الله: العلم صيد والكتابة قيده، قيد صيودك بالحبال الواثقة.",
    "قال عمر بن الخطاب رضي الله عنه: حاسبوا أنفسكم قبل أن تحاسبوا، وزنوها قبل أن توزنوا.",
    "قال ابن القيم رحمه الله: إضاعة الوقت أشد من الموت؛ لأن إضاعة الوقت تقطعك عن الله والدار الآخرة، والموت يقطعك عن الدنيا وأهلها.",
    "قال سفيان الثوري رحمه الله: ليكن حظ المؤمن منك ثلاثة: إن لم تنفعه فلا تضره، وإن لم تفرحه فلا تغمه، وإن لم تمدحه فلا تذمه.",
    "قال مالك بن دينار رحمه الله: اتقوا السَّوْفَة (التسويف)، فإنها من جنود إبليس.",
    "قال الفضيل بن عياض رحمه الله: بقدر ما يصغر الذنب عندك يعظم عند الله، وبقدر ما يعظم عندك يصغر عند الله.",
    "قال الإمام أحمد بن حنبل رحمه الله: الناس إلى العلم أحوج منهم إلى الطعام والشراب؛ لأن الرجل يحتاج إلى الطعام والشراب في اليوم مرة أو مرتين، وحاجته إلى العلم بعدد أنفاسه.",
    "قال يحيى بن معاذ الرازي رحمه الله: القلوب كالقدور تغلي بما فيها، وألسنتها مغارفها، فانظر إلى الرجل حين يتكلم، فإن لسانه يغترف لك مما في قلبه، حلو.. حامض.. عذب.. أجاج.. وغير ذلك، ويبين لك طعم قلبه اغتراف لسانه.",
    "قال عبد الله بن المبارك رحمه الله: لا يزال المرء عالماً ما طلب العلم، فإذا ظن أنه قد علم فقد جهل.",
    "قال أبو بكر الصديق رضي الله عنه: إن الله قرن وعده بوعيده؛ ليكون العبد راغباً راهباً.",
    "قال علي بن أبي طالب رضي الله عنه: المرء مخبوء تحت لسانه.",
    "قال ابن مسعود رضي الله عنه: اغد عالماً أو متعلماً، ولا تغد إمعة بين ذلك.",
    "قال الأوزاعي رحمه الله: عليك بآثار من سلف وإن رفضك الناس، وإياك وآراء الرجال وإن زخرفوه لك بالقول.",
    "قال وهب بن منبه رحمه الله: الإيمان عريان ولباسه التقوى.",
    "قال أبو الدرداء رضي الله عنه: استعيذوا بالله من خشوع النفاق. قيل له: وما خشوع النفاق؟ قال: أن ترى الجسد خاشعاً والقلب ليس بخاشع.",
    "قال الشافعي رحمه الله: رأيي صواب يحتمل الخطأ، ورأي غيري خطأ يحتمل الصواب.",
    "قال الحسن البصري رحمه الله: ما رأيت يقيناً لا شك فيه أشبه بشك لا يقين فيه من الموت.",
    "قال عمر بن عبد العزيز رحمه الله: أفضل العبادة أداء الفرائض واجتناب المحارم.",
    "قال ابن القيم رحمه الله: من أراد صفاء قلبه فليؤثر الله على شهوته.",
    "قال ابن تيمية رحمه الله: الاستغفار أكبر الحسنات وبابه واسع.",
    "قال الحسن البصري رحمه الله: تفقدوا الحلاوة في ثلاثة أشياء: في الصلاة، والقرآن، والذكر، فإن وجدتموها، وإلا فاعلموا أن الباب مغلق.",
    "قال الشافعي رحمه الله: أشد الأعمال ثلاثة: الجود من قلة، والورع في خلوة، وكلمة الحق عند من يرجى ويخاف.",
    "قال ابن مسعود رضي الله عنه: كونوا ينابيع العلم، مصابيح الهدى، أحلاس البيوت، سرج الليل، جدد القلوب، خلقان الثياب، تعرفون في السماء وتخفون على أهل الأرض.",
    "قال الفضيل بن عياض رحمه الله: ترك العمل من أجل الناس رياء، والعمل من أجل الناس شرك، والإخلاص أن يعافيك الله منهما.",
    "قال مالك بن دينار رحمه الله: ما زرع القرآن في قلوبكم يا أهل القرآن؟ إن القرآن ربيع المؤمن كما أن الغيث ربيع الأرض.",
    "قال سفيان الثوري رحمه الله: ما عالجت شيئاً أشد عليّ من نيتي؛ إنها تتقلب عليّ.",
    "قال عمر بن الخطاب رضي الله عنه: لا تنظروا إلى صيام أحد ولا إلى صلاته، ولكن انظروا إلى صدق حديثه إذا حدث، وإلى أمانته إذا اؤتمن، وإلى ورعه إذا أشفى.",
    "قال ابن القيم رحمه الله: القلب يمرض كما يمرض البدن، وشفاؤه في التوبة والحمية، ويصدأ كما تصدأ المرآة، وجلاؤه بالذكر، ويعرى كما يعرى الجسم، وزينته التقوى.",
    "قال الإمام أحمد رحمه الله: إذا مات أصدقاء الرجل بقي غريباً.",
    "قال الحسن البصري رحمه الله: المؤمن قوام على نفسه، يحاسب نفسه لله.",
    "قال علي بن أبي طالب رضي الله عنه: قيمة كل امرئ ما يحسنه.",
    "قال أبو الدرداء رضي الله عنه: لن تكون عالماً حتى تكون متعلماً، ولن تكون بالعلم عالماً حتى تكون به عاملاً.",
    "قال وهب بن منبه رحمه الله: مثل الذي يدعو بغير عمل كمثل الذي يرمي بغير وتر.",
    "قال ابن عباس رضي الله عنهما: لا كبيرة مع الاستغفار، ولا صغيرة مع الإصرار.",
    "قال الشافعي رحمه الله: من تعلم القرآن عظمت قيمته.",
    "قال عمر بن عبد العزيز رحمه الله: قيدوا نعم الله بشكر الله.",
    "قال ابن تيمية رحمه الله: القلوب الصادقة والأدعية الصالحة هي العسكر الذي لا يغلب.",
    "قال الفضيل بن عياض رحمه الله: من عرف الناس استراح. (أي عرف طبائعهم فلم يتوقع منهم الكثير).",
    "قال مالك بن أنس رحمه الله: لن يصلح آخر هذه الأمة إلا بما صلح به أولها.",
    "قال سفيان الثوري رحمه الله: إنما العلم للعمل به، فإن لم يعمل به صاحبه كان وبالاً عليه.",
    "قال ابن مسعود رضي الله عنه: من كان مستناً فليستن بمن قد مات، فإن الحي لا تؤمن عليه الفتنة. (يقصد الصحابة).",
    "قال ابن القيم رحمه الله: للعبد ستر بينه وبين الله، وستر بينه وبين الناس؛ فمن هتك الستر الذي بينه وبين الله هتك الله الستر الذي بينه وبين الناس.",
    "قال الحسن البصري رحمه الله: صاحبِ الناس بمثل ما تحب أن يصاحبوك به.",
    "قال الإمام أحمد رحمه الله: الصبر على الفقر مرتبة لا ينالها إلا الأكابر.",
    "قال علي بن أبي طالب رضي الله عنه: لا تستح من إعطاء القليل، فإن الحرمان أقل منه.",
    "قال أبو بكر الصديق رضي الله عنه: أصدق الصدق الأمانة، وأكذب الكذب الخيانة.",
    "قال الشافعي رحمه الله: كفى بالمرء فضلاً أن تُعد معايبه.",
    "قال عمر بن الخطاب رضي الله عنه: أصلحوا سرائركم تصلح لكم علانيتكم.",
    "قال ابن القيم رحمه الله: الدنيا لا تساوي نقل أقدامك إليها، فكيف تعدو خلفها؟",
    "قال الفضيل بن عياض رحمه الله: خصلتان تقسيان القلب: كثرة الكلام، وكثرة الأكل.",
    "قال مالك بن دينار رحمه الله: إن الصديقين إذا قرئ عليهم القرآن طربت قلوبهم إلى الآخرة.",
    "قال سفيان الثوري رحمه الله: احذر سخط الله في ثلاث: احذر أن تقصر فيما أمرك، واحذر أن يراك وأنت لا ترضى بما قسم لك، وأن تطلب شيئاً من الدنيا فلا تجده أن تسخط على ربك.",
    "قال ابن مسعود رضي الله عنه: لا يكن أحدكم إمعة، يقول: أنا مع الناس.",
    "قال الحسن البصري رحمه الله: لا يزال العبد بخير ما كان له واعظ من نفسه، وكانت المحاسبة من همته.",
    "قال الإمام أحمد رحمه الله: كل شيء من الخير يندم عليه صاحبه يوم القيامة إلا ذكر الله.",
    "قال علي بن أبي طالب رضي الله عنه: العلم خير من المال، العلم يحرسك وأنت تحرس المال.",
    "قال أبو الدرداء رضي الله عنه: اعبد الله كأنك تراه، فإن لم تكن تراه فإنه يراك.",
    "قال وهب بن منبه رحمه الله: إذا سمعت من يمدحك بما ليس فيك فلا تأمن أن يذمك بما ليس فيك.",
    "قال ابن عباس رضي الله عنهما: ذل الطالب للعلم عز.",
    "قال الشافعي رحمه الله: طلب العلم أفضل من صلاة النافلة.",
    "قال عمر بن عبد العزيز رحمه الله: إن الليل والنهار يعملان فيك فاعمل فيهما.",
    "قال ابن تيمية رحمه الله: ليس العاقل الذي يعلم الخير من الشر، وإنما العاقل الذي يعلم خير الخيرين، وشر الشرين.",
    "قال الفضيل بن عياض رحمه الله: المؤمن يستر وينصح، والفاجر يهتك ويعير.",
    "قال مالك بن أنس رحمه الله: ما قل عمل بر وتقوى، وكثر عمل بغير ذلك.",
    "قال سفيان الثوري رحمه الله: الزهد في الدنيا هو الزهد في الناس.",
    "قال ابن مسعود رضي الله عنه: إنكم في ممر الليل والنهار في آجال منقوصة، وأعمال محفوظة، والموت يأتي بغتة.",
    "قال ابن القيم رحمه الله: أربعة أشياء تُمرض الجسم: الكلام الكثير، والنوم الكثير، والأكل الكثير، والجماع الكثير. (تفسر في سياق الإفراط المذموم).",
    "قال الحسن البصري رحمه الله: إن العبد ليعمل الذنب فيدخل به الجنة، ويعمل الحسنة فيدخل بها النار! قالوا: كيف؟ قال: يعمل الذنب فلا يزال نصب عينيه، خائفاً منه، مشفقاً، باكياً، نادماً، فيورثه ذلك الذل والانكسار، ويعمل الحسنة فلا تزال نصب عينيه، يمن بها، ويتكبر بها، حتى تورثه العجب والكبر، فتكون سبب هلاكه.",
    "قال الإمام أحمد رحمه الله: التوكل: قطع الاستشراف باليأس من الخلق.",
    "قال علي بن أبي طالب رضي الله عنه: لا يعرف فضل أهل العلم إلا أهل الفضل.",
    "قال أبو بكر الصديق رضي الله عنه: لا يحقرن أحد أحداً من المسلمين، فإن صغير المسلمين عند الله كبير.",
    "قال الشافعي رحمه الله: ما جادلت أحداً إلا تمنيت أن يُظهر الله الحق على لسانه.",
    "قال عمر بن الخطاب رضي الله عنه: لا يغرنكم من قرأ القرآن، إنما هو كلام نتكلم به، ولكن انظروا من يعمل به.",
    "قال ابن القيم رحمه الله: من صدق توكله على الله في حصول شيء ناله.",
    "قال الفضيل بن عياض رحمه الله: إذا لم تقدر على قيام الليل وصيام النهار، فاعلم أنك محروم مكبل، كبلتك خطيئتك.",
    "قال مالك بن دينار رحمه الله: بقدر ما تحزن للدنيا يخرج هم الآخرة من قلبك، وبقدر ما تحزن للآخرة يخرج هم الدنيا من قلبك.",
    "قال سفيان الثوري رحمه الله: ليس للمؤمن راحة دون لقاء الله.",
    "قال ابن مسعود رضي الله عنه: اليقين أن لا ترضي الناس بسخط الله.",
    "قال الحسن البصري رحمه الله: إنما الفقيه الزاهد في الدنيا، الراغب في الآخرة، البصير بدينه، المداوم على عبادة ربه.",
    "قال الإمام أحمد رحمه الله: العلم لا يعدله شيء لمن صحت نيته. قالوا: وكيف تصح النية؟ قال: ينوي رفع الجهل عن نفسه وعن غيره.",
    "قال علي بن أبي طالب رضي الله عنه: الناس أعداء ما جهلوا.",
    "قال أبو الدرداء رضي الله عنه: ذروة الإيمان الصبر للحكم، والرضا بالقدر.",
    "قال وهب بن منبه رحمه الله: رأس الحكمة مخافة الله.",
    "قال ابن عباس رضي الله عنهما: العلم أكثر من أن يحاط به، فخذوا من كل علم أحسنه.",
    "قال الشافعي رحمه الله: لولا المحابر لجفت المقابر. (في أهمية تدوين العلم).",
    "قال عمر بن عبد العزيز رحمه الله: لا تصاحب فاجراً فتتعلم من فجوره.",
    "قال ابن تيمية رحمه الله: الرضا باب الله الأعظم، وجنة الدنيا، ومستراح العابدين.",
    "قال الفضيل بن عياض رحمه الله: رهبة العبد من الله على قدر علمه بالله.",
    "قال مالك بن أنس رحمه الله: الأدب أدب الله، لا أدب الآباء والأمهات.",
    "قال سفيان الثوري رحمه الله: أول العلم الصمت، والثاني الاستماع، والثالث الحفظ، والرابع العمل، والخامس النشر.",
    "قال ابن مسعود رضي الله عنه: لا يقلدن أحدكم دينه رجلاً، إن آمن آمن، وإن كفر كفر.",
    "قال ابن القيم رحمه الله: إذا أصبح العبد وأمسى وليس همه إلا الله وحده تحمّل الله عنه سبحانه حوائجه كلها.",
    "قال الحسن البصري رحمه الله: يا ابن آدم بع دنياك بآخرتك تربحهما جميعاً، ولا تبيعن آخرتك بدنياك فتخسرهما جميعاً.",
    "قال الإمام أحمد رحمه الله: الورع ترك ما يريبك.",
    "قال علي بن أبي طالب رضي الله عنه: لا تكن ممن يرجو الآخرة بغير عمل، ويؤخر التوبة لطول الأمل.",
    "قال أبو بكر الصديق رضي الله عنه: إني لأبغض أهل بيت ينفقون رزق أيام في يوم واحد. (في ذم الإسراف).",
    "قال الشافعي رحمه الله: سياسة الناس أشد من سياسة الدواب.",
    "قال عمر بن الخطاب رضي الله عنه: تعلموا العلم وعلموه الناس، وتعلموا له الوقار والسكينة.",
    "قال ابن القيم رحمه الله: من عاب أخاه بذنب لم يمت حتى يفعله.",
]

# --- دالة إرسال الاقتباس العشوائي (تعمل بدون / للكلمات المحددة في الخاص والمجموعات) ---
# استخدام filters.regex للتحقق من الكلمات المحددة فقط
# ^(نصيحة|نصيحه|فائدة)$ : تعني أن الرسالة يجب أن تبدأ وتنتهي بإحدى هذه الكلمات فقط
# تم إزالة filters.private ليعمل في المجموعات أيضاً
@app.on_message(filters.regex(r"^(نصيحة|نصيحه|فائدة)$"))
async def send_random_quote(_, message):
    """
    يرسل اقتباساً عشوائياً (نصيحة/فائدة) للمستخدم عند إرسال كلمة "نصيحة" أو "نصيحه" أو "فائدة" فقط.
    يعمل هذا الأمر في المحادثات الخاصة والمجموعات.
    """
    # إرسال رسالة مؤقتة للإشارة إلى المعالجة
    placeholder_message = await message.reply_text("...")

    # التحقق من أن القائمة ليست فارغة
    if not SALAF_ADVICE:
        await placeholder_message.edit("عذراً، قائمة الاقتباسات فارغة حالياً.")
        return

    # اختيار اقتباس عشوائي من القائمة
    random_quote = random.choice(SALAF_ADVICE)

    # تعديل الرسالة المؤقتة لعرض الاقتباس (نص عريض وبدون مقدمة)
    try:
        await placeholder_message.edit(f"**{random_quote}**")
    except Exception as e:
        # في حالة حدوث خطأ
        print(f"حدث خطأ أثناء تعديل الرسالة (اقتباس): {e}")
        try:
            # محاولة إرسال رسالة جديدة كبديل
            await message.reply_text(f"**{random_quote}**")
            await placeholder_message.delete() # حذف الرسالة المؤقتة
        except Exception as final_e:
            print(f"حدث خطأ أيضاً أثناء إرسال رسالة جديدة (اقتباس): {final_e}")

# --- معلومات الوحدة (Module Info) ---
# اسم الوحدة لا يزال مناسباً
__MODULE__ = "النصائح والفوائد"
# تحديث نص المساعدة ليعكس عمل الأمر في كل مكان
__HELP__ = """
**✨ وحدة النصائح والفوائد ✨**

هذه الوحدة تقدم لك حكماً ومواعظ وفوائد من أقوال السلف الصالح رضوان الله عليهم.

**الأوامر المتاحة:**
\n- أرسل `نصيحة` أو `نصيحه` أو `فائدة` (بدون /): للحصول على اقتباس عشوائي (يعمل في الخاص والمجموعات).
"""

