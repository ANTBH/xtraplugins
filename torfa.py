import requests
import random  # استيراد مكتبة الاختيار العشوائي
import re     # استيراد مكتبة التعابير النمطية
from pyrogram import filters
from YukkiMusic import app  # افتراض أن هذا هو كائن التطبيق الخاص بك

# قائمة بالطرائف العربية المضحكة
# تم تجميع قائمة أكبر وإزالة الفائدة
arabic_anecdotes = [
    "سُئل جحا: أيهما أنفع الشمس أم القمر؟ أجاب: القمر! لأن الشمس تطلع في النهار والضوء موجود، أما القمر فيطلع في الليل والدنيا مظلمة ونحن بحاجة إليه.",
    "رأى جحا الناس يهربون فظن أنهم يوزعون شيئاً فتبعهم، ثم سأل أحدهم: ممّ تهربون؟ قال: يجمعون الناس للعمل سخرة (بدون أجر). فهرب جحا أسرع منهم وقال: ربما يختارون الحمقى أولاً!",
    "ضاع حمار جحا فأخذ يحمد الله ويشكره. فسألوه: لماذا تحمد الله وقد ضاع حمارك؟ قال: أشكره لأني لم أكن راكباً عليه، وإلا لضعت معه!",
    "قال رجلٌ لبخيل: لِمَ لا تدعوني إلى طعامك؟ فقال البخيل: لأنك جيّد المضغِ، سريع البلع، إذا أكلتَ لقمةً هيَّأتَ أخرى! فقال الرجل: وهل تريدني أن أصلي ركعتين بين كل لقمتين؟!",
    "مرض نحوي، فعاده جاره وسأله: ما بكَ؟ فقال النحوي: حمى جاسية، نارها حامية، منها الأعضاء واهية، والعظام بالية! فقال له جاره الأمي: يا ليتها كانت القاضية!",
    "سأل أعرابي رجلاً عن اسمه فقال: بحر. قال: ابن من؟ قال: ابن فياض. قال: ما كنيتك؟ قال: أبو الندى. فقال الأعرابي: لا ينبغي لأحدٍ لقاؤك إلا في زورق!",
    "وقف أعرابي معوج الفم أمام أحد الولاة فألقى قصيدة في الثناء عليه، فلم يعطه الوالي شيئاً وسأله: ما بال فمك معوجاً؟ فرد الشاعر: لعله عقوبة من الله لكثرة الثناء بالباطل على بعض الناس.",
    "سأل رجلٌ الشعبي: إذا أردت أن أستحمّ في نهر فهل أجعل وجهي تجاه القبلة أم عكسها؟ قال الشعبي: بل باتجاه ثيابك حتى لا تسرق!",
    "كان رجل يسكن في دار بالإيجار وسقفها يتفرقع، فقال لصاحب الدار: أصلح السقف فإنه يتفرقع. قال المالك: لا تخف، إنه يسبح الله. فقال المستأجر: أخشى أن تدركه الخشية فيسجد!",
    "تزوج جحا امرأة حولاء ترى الشيء شيئين. فلما أراد الغداء أتى برغيفين فرأتهما أربعة. فقالت: ما تصنع بأربعة أرغفة؟ يكفينا اثنان! ففرح جحا. ثم وضعت الإناء أمامهما فرمته به وقالت: أتأتي برجل غريب لينظر إلي؟ فقال جحا: يا حبيبتي أبصري كل شيء اثنين إلا زوجك!",
    "اشترى جحا حماراً، فركبه ابنه ومشى جحا، فقال الناس: انظروا إلى هذا الأب القاسي! فركب جحا ومشى الابن، فقالوا: انظروا إلى هذا الابن العاق! فركبا معاً، فقالوا: لا يرحمان الحمار! فنزلا وحملا الحمار، فقالوا: انظروا إلى هذين المجنونين!",
    "رأى جحا خاتمه يلمع في الظلام تحت السرير، فأخذ يبحث عنه في فناء الدار تحت ضوء الشمس. سألوه: أين ضاع خاتمك؟ قال: تحت السرير. قالوا: فلماذا تبحث عنه هنا؟ قال: لأن النور هنا أوضح!",
    "قال بخيل لابنه: إذا أردت أن تأكل الخبز فاذهب إلى بيت الجيران وقل لهم أبي يدعوكم لتناول الخبز معنا، فإذا اعتذروا فكل وحدك!",
    "قيل لبخيل: لماذا لا تأكل الفاكهة؟ قال: أشتريها وأستمتع بالنظر إليها حتى تفسد، ثم أرميها!",
    "رأى بخيل درهماً قديماً فقال له: الآن ترتاح ولا تضايقك يدٌ بعد اليوم، الآن ترقد في مثواك الأخير.",
    "مات مجوسي وعليه دين كثير، فقال الغرماء لابنه البخيل: بع دار أبيك وسدد دينه. قال الابن: إذا بعت الدار وسددت دينه، فهل يدخل الجنة؟ قالوا: لا. قال: فَدَعهُ في النار وأنا في الدار!",
    "بشرت امرأة زوجها البخيل بأن ابنه نبتت أسنانه، فقال: أتبشريني بعدو الخبز؟! الحقي بأهلك فإنك طالق!",
    "قالت أعرابية تصف بخل زوجها: والله ما يقيم الفأر في بيته إلا لحب الوطن!",
    "ركب نحوي سفينة، فسأل بحاراً: هل تعرف النحو؟ قال: لا. قال النحوي: ذهب نصف عمرك! هاجت عاصفة، فسأل البحار النحوي: هل تعرف السباحة؟ قال: لا. قال البحار: ذهب كل عمرك!",
    "سأل نحوي أعرابياً في مجلس علم: أتجُرّ فلسطين؟ (يقصد الجر النحوي). فرد الأعرابي: إني إذاً لقوي! (ظن أنه الجر الحقيقي).",
    "ادعى رجل النبوة أيام المهدي، فأُدخل عليه؛ فقال له: أأنتَ نبي؟ قال: نعم. قال: وإلى مَن بُعثتَ؟ قال: أوَ تركتموني أذهب إلى أحد؟! ساعةَ بُعِثْتُ وضعتموني في الحبس!",
    "صلى إمام صلاة خفيفة وقال: اللهم زوجني الحور العين. فقال له رجل: أسأت النقد، وأعظمت الخطبة!",
    "قال رجل لغلام: بكم تعمل معي؟ قال: بطعامي. قال: فأحسن قليلاً. قال الغلام: فأصوم الاثنين والخميس؟",
    "قال الأصمعي: مررت بأعرابي يقرأ: (والسارق والسارقة فاقطعوا أيديهما جزاء بما كسبا نكالاً من الله والله غفور رحيم). فقلت: يا أعرابي، لقد حرفت! إنها (والله عزيز حكيم). قال الأعرابي: عزّ فحكم فقطع، ولو غفر ورحم لما قطع!",
    "وقف أعرابي يصلي فقرأ الإمام (ألم نهلك الأولين)، وكان في الصف الثاني، فذهب إلى الصف الأول. ثم قرأ (ثم نتبعهم الآخرين)، فرجع إلى الصف الثاني. ثم قرأ (كذلك نفعل بالمجرمين)، فترك الصلاة وخرج وهو يقول: ما يريد غيري!",
    "قال القاضي إياس بن معاوية لرجل: لو رميتك بالتراب، أيوجعك؟ قال: لا. قال: لو صببت عليك ماء، أيكسرك؟ قال: لا. قال: لو صنعت من الماء والتراب طوباً فضربتك به، أيكسرك؟ قال: نعم. قال: فكذلك النبيذ، هو من التمر والماء.",
    "قيل لأعرابي: ما اسم المرق عندكم؟ قال: السخين. قيل: فإذا برد؟ قال: لا ندعه حتى يبرد.",
    "رأى الحجاج أعرابياً يأكل بشراهة فقال: أراك تأكل التمر كأنه خرج من عرس أمه! فقال الأعرابي: وأراك تنظر إليه كأنك شيّعت أمه!",
    "جاء رجل إلى الشعبي وقال: إني تزوجت امرأة ووجدتها عرجاء، فهل لي أن أردها؟ فقال الشعبي: إن كنت تريد أن تسابق بها فردها!",
    "قال رجل للأحنف بن قيس: بم سدت قومك؟ قال: بتركي ما لا يعنيني، كما عناك من أمري ما لا يعنيك.",
    "قيل لأشعب الطماع: ما بلغ من طمعك؟ قال: ما رأيت عروساً تُزف إلا كنست بيتي رجاء أن تُهدى إليّ!",
    "دخل لص بيت أبي الأسود الدؤلي فلم يجد شيئاً يسرقه، فدخل أبو الأسود وقال: تخجل يا هذا؟ لم تجد شيئاً في الدنيا فأتيت تطلبه في الآخرة؟",
    "مرت امرأة حسناء بمجلس فقالت: ما لكم جلوساً كأنكم بلا أزواج؟ فقال رجل: قد مات أزواجنا. قالت: فما لكم لا تتزوجون؟ قال: قلة ذات اليد. قالت: فما يمنعكم أن تضموا خماساً إلى سداس؟ (تقصد الزواج الجماعي لتقليل التكاليف).",
    "قالت جارية لهارون الرشيد عندما نثر الدنانير والجواري يلتقطنها وهي واقفة تنظر إليه: إن مطلوبي ليس الدنانير، بل صاحب الدنانير.",
    "سأل المأمون جارية عربية عن نسبها فاستطاعت تحديده بدقة وفراسة حتى وصلت إلى أنه من بني هاشم، فقالت: السلام عليك يا أمير المؤمنين.",
    # يمكنك إضافة المزيد هنا
]

# استخدام فلتر regex للتحقق مما إذا كانت الرسالة تحتوي فقط على إحدى الكلمات المحددة
# ^ تعني بداية السطر، $ تعني نهاية السطر، | تعني أو
# هذا يضمن أن الرسالة بأكملها هي إحدى هذه الكلمات فقط
@app.on_message(filters.regex(r"^(طرفة|نكته|نكتة|طرفه)$"))
async def get_arabic_joke(_, message):
    """
    هذه الدالة تستجيب للكلمات المحددة (بدون /) وترسل طرفة عربية عشوائية.
    """
    try:
        # اختيار طرفة عشوائية من القائمة
        selected_joke = random.choice(arabic_anecdotes)

        # إرسال الطرفة كرد على الرسالة (النص فقط)
        await message.reply_text(selected_joke)

    except Exception as e:
        # في حال حدوث خطأ (مثل قائمة فارغة)، أرسل رسالة خطأ
        await message.reply_text("عذراً، حدث خطأ أثناء جلب الطرفة.")
        print(f"Error in get_arabic_joke: {e}")

# ملاحظة: تأكد من أن لديك كائن `app` مهيأ بشكل صحيح من مكتبة pyrogram
# وأن هذا الملف جزء من البوت الخاص بك.
